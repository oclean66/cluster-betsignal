<html lang="es">

<head>
  <meta name="theme-color" content="#f8a31f">
  <meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
  <!-- <link rel="stylesheet" type="text/css" href="https://kingdeportes.net/acme/assets/11e0c0de/css/Chart.min.css"> -->
  <link rel="stylesheet" type="text/css"
    href="https://kingdeportes.net/acme/themes/flatcss/css/plugins/timepicker/bootstrap-timepicker.min.css"
    media="screen">
  <link rel="stylesheet" type="text/css" href="https://kingdeportes.net/acme/themes/flatcss/css/bootstrap.min.css"
    media="screen">
  <link rel="stylesheet" type="text/css"
    href="https://kingdeportes.net/acme/themes/flatcss/css/plugins/jquery-ui/smoothness/jquery-ui.css"
    media="screen">
  <link rel="stylesheet" type="text/css"
    href="https://kingdeportes.net/acme/themes/flatcss/css/plugins/jquery-ui/smoothness/jquery.ui.theme.css"
    media="screen">
  <link rel="stylesheet" type="text/css"
    href="https://kingdeportes.net/acme/themes/flatcss/css/plugins/gritter/jquery.gritter.css" media="screen">
  <link rel="stylesheet" type="text/css" href="https://kingdeportes.net/acme/themes/flatcss/css/sport.css">
  <link rel="stylesheet" type="text/css" href="https://kingdeportes.net/acme/themes/flatcss/css/style.css"
    media="screen">
  <link rel="stylesheet" type="text/css" href="https://kingdeportes.net/acme/themes/flatcss/css/themes.css"
    media="screen">
  <link rel="stylesheet" type="text/css"
    href="https://kingdeportes.net/acme/themes/flatcss/css/plugins/dynatree/ui.dynatree.css" media="screen">
  <link rel="stylesheet" type="text/css" href="https://kingdeportes.net/acme/themes/flatcss/css/print.css"
    media="print">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.1/css/all.min.css"
    integrity="sha512-+4zCK9k+qNFUR5X+cKL9EIR+ZOhtIloNl9GIKS57V1MyNsYpYcUrUeQc9vNfzsWfV28IaLL3i96P9sdNyeRssA=="
    crossorigin="anonymous" referrerpolicy="no-referrer" />
  <script type="text/javascript" src="https://kingdeportes.net/acme/assets/9779edf9/jquery.min.js"></script>
  <!-- <script type="text/javascript" src="https://kingdeportes.net/acme/assets/11e0c0de/js/Chart.min.js"></script> -->
  <script type="text/javascript"
    src="https://kingdeportes.net/acme/themes/flatcss/js/plugins/nicescroll/jquery.nicescroll.min.js"></script>
  <script type="text/javascript"
    src="https://kingdeportes.net/acme/themes/flatcss/js/plugins/jquery-ui/jquery.ui.core.min.js"></script>
  <script type="text/javascript"
    src="https://kingdeportes.net/acme/themes/flatcss/js/plugins/jquery-ui/jquery.ui.widget.min.js"></script>
  <script type="text/javascript"
    src="https://kingdeportes.net/acme/themes/flatcss/js/plugins/jquery-ui/jquery.ui.mouse.min.js"></script>
  <script type="text/javascript"
    src="https://kingdeportes.net/acme/themes/flatcss/js/plugins/jquery-ui/jquery.ui.draggable.min.js"></script>
  <script type="text/javascript"
    src="https://kingdeportes.net/acme/themes/flatcss/js/plugins/jquery-ui/jquery.ui.resizable.min.js"></script>
  <script type="text/javascript"
    src="https://kingdeportes.net/acme/themes/flatcss/js/plugins/jquery-ui/jquery.ui.sortable.min.js"></script>
  <script type="text/javascript"
    src="https://kingdeportes.net/acme/themes/flatcss/js/plugins/slimscroll/jquery.slimscroll.min.js"></script>
  <script type="text/javascript" src="https://kingdeportes.net/acme/themes/flatcss/js/bootstrap.min.js"></script>
  <script type="text/javascript"
    src="https://kingdeportes.net/acme/themes/flatcss/js/plugins/bootbox/jquery.bootbox.js"></script>
  <script type="text/javascript"
    src="https://kingdeportes.net/acme/themes/flatcss/js/plugins/form/jquery.form.min.js"></script>
  <script type="text/javascript"
    src="https://kingdeportes.net/acme/themes/flatcss/js/plugins/dynatree/jquery.dynatree.js"></script>
  <script type="text/javascript"
    src="https://kingdeportes.net/acme/themes/flatcss/js/plugins/gritter/jquery.gritter.min.js"></script>
  <script type="text/javascript"
    src="https://kingdeportes.net/acme/themes/flatcss/js/plugins/validation/jquery.validate.min.js"></script>
  <script type="text/javascript"
    src="https://kingdeportes.net/acme/themes/flatcss/js/plugins/validation/additional-methods.min.js"></script>
  <script type="text/javascript"
    src="https://kingdeportes.net/acme/themes/flatcss/js/plugins/timepicker/bootstrap-timepicker.min.js"></script>
  <script type="text/javascript" src="https://kingdeportes.net/acme/themes/flatcss/js/eakroko.min.js"></script>
  <script type="text/javascript" src="https://kingdeportes.net/acme/themes/flatcss/js/application.min.js"></script>
  <script type="text/javascript"
    src="https://kingdeportes.net/acme/themes/flatcss/js/demonstration.min.js"></script>
  <title>Socket Admin</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="Administrador de Apuestas">
  <meta name="author" content="ACME, Administrador de Cuotas de Mercado">


  <!-- <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha384-HSMxcRTRxnN+Bdg0JdbxYKrThecOKuH5zCYotlSAcp1+c8xmyTe9GYg1l9a69psu" crossorigin="anonymous">         -->
  <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/push.js/0.0.11/push.min.js"></script>

  <!-- <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.15.1/css/all.css" crossorigin="anonymous"> -->
  <!-- Favicon -->
  <link rel="shortcut icon" href="https://kingdeportes.net/acme/themes/flatcss/img/favicon.png">
  <!-- Apple devices Homescreen icon -->
  <link rel="apple-touch-icon-precomposed" href="https://kingdeportes.net/acme/themes/flatcss/img/favicon.png">
  <style>
    /* width */
    ::-webkit-scrollbar {
      width: 10px;
    }

    /* Track */
    ::-webkit-scrollbar-track {
      background: #f1f1f1;
    }

    /* Handle */
    ::-webkit-scrollbar-thumb {
      background: orange;
    }

    /* Handle on hover */
    ::-webkit-scrollbar-thumb:hover {
      background: #555;
    }
  </style>
</head>

<body data-mobile-sidebar="button" class="theme-darkblue" data-theme="theme-darkblue"
  onload="$('#progress').attr('style', 'width:0%')">

  <div id="navigation" class="navbar-fixed-top">
    <!-- Require the navigation -->
    <div class="hidden" id="winButtons" style="background-color: #222222; height:30px">
      <div class="user">
        <div class="btn-group">
          <!-- <button class="btn btn-danger"><i class="fa fa-window-minimize"></i></button> -->
          <button class="btn btn-danger"><i class="fa fa-minus"></i></button>
          <button id="win-close" class="btn btn-danger"> <i class="fa fa-times"></i></button>
        </div>
      </div>
    </div>


    <div class="container-fluid">
      <h4 style="color:white;font-weight: bolder;">Socket.io Admin</h4>
    </div>
    <div class="progress progress-striped active" style="margin: 0; height: 5px;background: rgba(5,0,0,0.12);">
      <div id="progress" class="progress-bar" role="progressbar" aria-valuenow="100" aria-valuemin="0"
        aria-valuemax="100" style="width:0%">

      </div>
    </div>




  </div><!-- /#navigation-main -->

  <div class="" id="content" style="padding-top: 40px; min-height: auto; height: 691px;">



    <div id="main" style="padding: 0;">
      <div class="container-fluid">
        <!-- Include content pages -->

        <div id="left" class="sidebar-fixed forced-hide ui-sortable ui-resizable"
          style="display: none; top: 40px; height: 691px;">




          <div class="ui-resizable-handle ui-resizable-e" style="z-index: 90; height: 691px; top: 0px;"></div>
        </div>

        <style type="text/css">
          #main {
            margin-left: 0;
          }
        </style>




        <div class="row">
          <div class="col-sm-12">
            <div class="box box-bordered box-color">
              <div class="box-title">
                <h3>
                  <i class="fa fa-envelope"></i>
                  Usuario en linea (<span id="total">0</span>)
                </h3>
              </div>
              <div class="box-content nopadding" id="box-content" style="height: 100%;">
                <ul class="tabs tabs-inline tabs-left" id="tabs-room"
                  style="height: 100%; overflow-y: scroll;padding: 0;">

                </ul>

                <div class="tab-content tab-content-inline" id="content-room">
                  <div class="tab-pane active" id="trash">
                    <div class="col-sm-2" style="border:1px solid red; height:100%; padding:0">
                      <ul class="tabs tabs-inline tabs-left" id="tabs-room-users"
                        style="height: 100%; width:100%; overflow-y: scroll; padding: 0;">

                      </ul>
                    </div>
                    <div class="col-sm-4" style="padding: 0;" >
                      <div class="table-responsive" id="room-list" style="height: 100%;">

                        <table class="table table-hover table-nomargin table-condensed ">

                        </table>
                      </div>
                    </div>
                    <div class="col-sm-6" style="padding: 0;">
                      <div class="box-content nopadding" style="overflow: hidden; width: auto;">
                        <ul id="messages" class="messages" style="overflow: auto; height: 100%;">

                        </ul>
                        <form id="form" action="">
                          <div class="text">
                            <input id="input" autocomplete="off" type="text" name="text" placeholder="Write here..."
                              class="form-control">
                          </div>
                          <div class="submit">
                            <button type="submit">
                              <i class="fa fa-share"></i>
                            </button>
                          </div>
                        </form>
                      </div>
                    </div>

                  </div>

                </div>
              </div>
            </div>

          </div>


          <div class="col-sm-12">
            <form name="publish">
              <input type="text" name="message" maxlength="50"/>
              <input type="submit" value="Send"/>
            </form>
            
            <div id="messages"></div>
          </div>

        </div>

        <!-- <script src="https://cdn.socket.io/4.5.4/socket.io.min.js"></script> -->
        <script src="/socket.io/socket.io.js"></script>
        <script src="public.js"></script>
        <script>


          $("#messages").height($(window).height() - 211);
          $("#box-content").height($(window).height() - 125);
          $("#tabs-room").height($(window).height() - 125);
          var open = 0;
          var rooms = "";

          function setOpen(params) {
            open = params;
            console.log(open);
            // console.log(room[open]);
            var result = rooms.filter(function (number) {
              return number.name == open
            });
            console.log(result);
            var list = document.getElementById('room-list'); //<li class=""><a href="#trash" data-toggle="tab"><i class="fa fa-trash-o"></i>Trash</a></li>
            list.innerHTML = "";
            result.forEach(e => {
              const tbl = document.createElement('table');
              tbl.className = "table table-hover table-nomargin table-condensed";
              // tbl.style = "height:100%;";
              const tblHead = document.createElement("thead");
              const row = document.createElement("tr");
              
              const cell = document.createElement("th");
              const cellText = document.createTextNode(`Room: ${e.name}, Size: ${e.users.length}`);
              cell.appendChild(cellText);
              row.appendChild(cell);

              const cellIp = document.createElement("th");
              const cellTextIp = document.createTextNode(`Ip address`);
              cellIp.appendChild(cellTextIp);
              row.appendChild(cellIp);

              tblHead.appendChild(row);

              const tblBody = document.createElement("tbody");
              // tblBody.style = "height:100%;overflow:auto;display:block;";
              e.users.forEach(i => {
                const row = document.createElement("tr");
                
                const cell = document.createElement("td");
                const cellText = document.createTextNode(`${i.userid}`);
                cell.appendChild(cellText);
                row.appendChild(cell);

                const cellIp = document.createElement("td");
                const cellTextIp = document.createTextNode(`${i.address}`);
                cellIp.appendChild(cellTextIp);
                row.appendChild(cellIp);

                tblBody.appendChild(row);
              })

              tbl.appendChild(tblHead);
              tbl.appendChild(tblBody);
              list.appendChild(tbl);
              console.log(e);
            })
          }

          // var socket = io.connect("https://kingdeportes.net:3000?userid=thisView", {});
          var socket = io.connect(url, {});
          // var socket = io();

          socket.on('connect', function () {
            // Connected, let's sign-up for to receive messages for this room
            socket.emit('subscribe', 'server');
            socket.emit('subscribe', 'status');
            socket.emit('getRooms');
          });
          socket.on('rooms', function (msg) {
            // var list = document.getElementById('rooms');
            // list.innerHTML = JSON.stringify(msg, null, 4);
            console.log(msg);
            var list = document.getElementById('tabs-room'); //<li class=""><a href="#trash" data-toggle="tab"><i class="fa fa-trash-o"></i>Trash</a></li>
            list.innerHTML = "";
            var listed = document.getElementById('tabs-room-users'); //<li class=""><a href="#trash" data-toggle="tab"><i class="fa fa-trash-o"></i>Trash</a></li>
            listed.innerHTML = "";
            rooms = msg.data;
            msg.data.forEach(element => {
              if (element.active != 0) {
                var entry = document.createElement('li');
                if (element.active == 1 && element.users[0].id == element.name) {
                  entry.innerHTML = '<a href="#' + element.name + '" data-toggle="tab" onclick="setOpen(\'' + element.name + '\')" ><i class="fa fa-user"></i> ' + element.users[0].userid + '</a>';
                  list.appendChild(entry);
                } else {
                  entry.innerHTML = '<a href="#' + element.name + '" data-toggle="tab" onclick="setOpen(\'' + element.name + '\')" ><i class="fa fa-users"></i> ' + element.name + ' (' + element.active + ')</a>';
                  listed.appendChild(entry);
                }
              }
            });

            setOpen(open);
          });
          socket.on('users', function (msg) {
            // var list = document.getElementById('user-list');
            var total = document.getElementById('total');
            total.innerHTML = msg.length;

            // list.innerHTML = "";
            // msg.forEach(element => {
            //   var entry = document.createElement('li');
            //   entry.innerHTML = "<b>" + element.id + " - " + element.userid + "</b><br/>" + element.address;
            //   // entry.appendChild(document.createTextNode(element.userid+"<br/>"+element.ipaddress));
            //   list.appendChild(entry);

            // });

          });
          socket.onAny(function (channel, msg) {
            if (channel != 'users' && channel != 'rooms') {
              const d = new Date();

              var item = document.createElement('li');
              item.innerHTML = '<li class="right"><div class="message" style="margin: 0;padding: 10px;border-radius: 5px;"><b>' + channel + ':</b> <p>' + JSON.stringify(msg) + '</p><small>' + (d.getHours() + ":" + d.getMinutes() + ":" + d.getSeconds()) + '</small></div></li>';
              // item.textContent = msg;
              messages.appendChild(item);
              messages.scrollTo(0, messages.scrollHeight);
            }
          });
          var messages = document.getElementById('messages');
          var form = document.getElementById('form');
          var input = document.getElementById('input');

          form.addEventListener('submit', function (e) {
            e.preventDefault();
            if (input.value) {
              socket.emit('chat message', input.value);
              input.value = '';
            }
          });



        //------------------------------------
        // plain socket
        // let plain_socket = new WebSocket('wss://ns526647.ip-149-56-17.net:3000/ws');
        // const msg = {
        //   userid: 'DionisioPlain', 
        //   feversion: 'socket',
        //   dkversion: 'web'
        // };
        // plain_socket.send(JSON.stringify(msg));

        // // send message from the form
        // document.forms.publish.onsubmit = function() {
        //   let outgoingMessage = this.message.value;

        //   plain_socket.send(outgoingMessage);
        //   return false;
        // };

        // // handle incoming messages
        // plain_socket.onmessage = function(event) {
        //   let incomingMessage = event.data;
        //   showMessage(incomingMessage);
        // };

        // plain_socket.onclose = event => console.log(`Closed ${event.code}`);

        // show message in div#messages
        // function showMessage(message) {
        //   let messageElem = document.createElement('div');
        //   messageElem.textContent = message;
        //   document.getElementById('messages').prepend(messageElem);
        // }
        //------------------------------------
        </script>


      </div>
    </div>
  </div>



  <script>
    $("ul.pagination > li > a").addClass('not-link');
    $('a:not(.not-link):not(.dropdown-toggle):not([target="_blank"]):not([href="#"]):not([data-toggle="collapse"])').click(function () {
      $('#progress').attr('style', 'width:100%');
    });
  </script>




</body>

</html>